function Get-RemoveMalwareBazaarEntries{
<#
.SYNOPSIS
    We want to filter out Malware Bazaar entries bc we are going to submit to MB.
    Security is stronger together.
#>
            
# --- Configuration ---
$InputFile = Read-Host "Enter path of file to modify"
$OutputFile = ".\MalwareBazaarRemoved.csv"

# Regex to match MD5, SHA1, or SHA256
$HashRegex = '^[A-Fa-f0-9]{32}$|^[A-Fa-f0-9]{40}$|^[A-Fa-f0-9]{64}$'

Write-Host "--- PowerShell Hash Filter ---"
Write-Host "Starting script..."

# 1. Load the CSV
try {
    $iocList = Import-Csv -Path $InputFile
    Write-Host "Successfully loaded $($iocList.Count) rows from $InputFile"
}
catch {
    Write-Error "Failed to import CSV. Make sure it's a valid CSV file. Error: $_"
    return
}

# 2. Extract *only* rows that are hashes
# -match uses regex, so we can find all 3 hash types
$allHashes = $iocList | Where-Object { $_.IOC -match $HashRegex }
$totalHashes = ($allHashes | Measure-Object).Count
Write-Host "Found $totalHashes total hash IOCs."

# 3. Filter out hashes that are from MalwareBazaar
#    -match is case-insensitive by default and handles partial matches.
#    This will find "Malware Bazaar" even in a list like "AlienVault, Malware Bazaar, SOCRadar"
$filteredHashes = $allHashes | Where-Object { $_.Sources -notmatch "Malware Bazaar" }
$finalCount = ($filteredHashes | Measure-Object).Count
$removedCount = $totalHashes - $finalCount

Write-Host "Removed $removedCount hashes with 'Malware Bazaar' in 'Sources' column."

# 4. Save the final list
try {
    $filteredHashes | Export-Csv -Path $OutputFile -NoTypeInformation -Encoding UTF8
    Write-Host "---"
    Write-Host "Successfully saved $finalCount hashes to $OutputFile" -ForegroundColor Green
}
catch {
    Write-Error "Failed to save output file: $_"
}

}