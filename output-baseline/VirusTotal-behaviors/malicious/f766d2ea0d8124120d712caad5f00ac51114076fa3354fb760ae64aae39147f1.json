{
    "data":  {
                 "processes_tree":  [
                                        {
                                            "process_id":  "2400",
                                            "name":  "rundll32.exe",
                                            "children":  [
                                                             {
                                                                 "process_id":  "2676",
                                                                 "name":  "rundll32.exe"
                                                             }
                                                         ]
                                        }
                                    ],
                 "command_executions":  [
                                            "\"C:\\Windows\\System32\\rundll32.exe\" C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll,DllRegisterServer",
                                            "\"C:\\Windows\\System32\\rundll32.exe\" C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll,AxAotyZbWz",
                                            "\"C:\\Windows\\System32\\rundll32.exe\" C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll,#1",
                                            "\"C:\\Windows\\System32\\rundll32.exe\" C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll,BPGiEALui",
                                            "\"C:\\Windows\\System32\\rundll32.exe\" C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll,CBsezo"
                                        ],
                 "dns_lookups":  [
                                     {
                                         "hostname":  "time.windows.com",
                                         "resolved_ips":  [
                                                              "40.119.148.38"
                                                          ]
                                     }
                                 ],
                 "processes_created":  [
                                           "rundll32.exe"
                                       ],
                 "mbc":  [
                             {
                                 "id":  "C0058",
                                 "objective":  "Data",
                                 "behavior":  "Modulo",
                                 "refs":  [
                                              {
                                                  "ref":  "#signature_matches",
                                                  "value":  "calculate modulo 256 via x86 assembly"
                                              }
                                          ]
                             },
                             {
                                 "id":  "B0001.019",
                                 "objective":  "Anti-Behavioral Analysis",
                                 "behavior":  "Debugger Detection",
                                 "method":  "Process Environment Block",
                                 "refs":  [
                                              {
                                                  "ref":  "#signature_matches",
                                                  "value":  "PEB access"
                                              }
                                          ]
                             }
                         ],
                 "signature_matches":  [
                                           {
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "calculate modulo 256 via x86 assembly",
                                               "authors":  [
                                                               "moritz.raabe@mandiant.com"
                                                           ],
                                               "rule_src":  "rule:\n  meta:\n    name: calculate modulo 256 via x86 assembly\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: instruction\n      dynamic: unsupported  # requires mnemonic features\n    mbc:\n      - Data::Modulo [C0058]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049A9\n  features:\n    #  and ecx, 800000FFh\n    #  and ecx, 0FFh\n    - and:\n      - mnemonic: and\n      - or:\n        - number: 0x800000FF\n        - number: 0xFF\n"
                                           },
                                           {
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "PEB access",
                                               "authors":  [
                                                               "michael.hunhoff@mandiant.com"
                                                           ],
                                               "rule_src":  "rule:\n  meta:\n    name: PEB access\n    authors:\n      - michael.hunhoff@mandiant.com\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: unsupported  # requires characteristic, offset, mnemonic features\n    mbc:\n      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block [B0001.019]\n    references:\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp\n    examples:\n      - al-khaser_x86.exe_:0x420D20\n  features:\n    - or:\n      - characteristic: peb access\n      - and:\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L41\n        - arch: i386\n        - characteristic: fs access\n        - or:\n          # in 0f5d5d07c6533bc6d991836ce79daaa1\n          # then we have:\n          #\n          #     xor edx, edx\n          #     mov edx, fs:[edx+30h]\n          - offset: 0x30\n          - instruction:\n            # in the case of CallObfuscator, gs:[rax]\n            - mnemonic: add\n            - number: 0x30\n      - and:\n        - arch: amd64\n        - characteristic: gs access\n        - or:\n          - offset: 0x60\n          - instruction:\n            - mnemonic: add\n            - number: 0x60\n      - and:\n        # WoW64 PEB address is fetched via the WoW64 Thread Environment Block (TEB) at FS:[0x18]-0x2000\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L45\n        - characteristic: fs access\n        - instruction:\n          - mnemonic: sub\n          - number: 0x2000\n",
                                               "refs":  [
                                                            {
                                                                "ref":  "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp"
                                                            }
                                                        ]
                                           },
                                           {
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "contain loop",
                                               "authors":  [
                                                               "moritz.raabe@mandiant.com"
                                                           ],
                                               "rule_src":  "rule:\n  meta:\n    name: contain loop\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic features\n    examples:\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\n  features:\n    - or:\n      - characteristic: loop\n      - characteristic: tight loop\n      - characteristic: recursive call\n"
                                           },
                                           {
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "get OS version",
                                               "authors":  [
                                                               "@mr-tz"
                                                           ],
                                               "rule_src":  "rule:\n  meta:\n    name: get OS version\n    authors:\n      - \"@mr-tz\"\n    lib: true\n    scopes:\n      static: function\n      dynamic: call\n    examples:\n      - 493167E85E45363D09495D0841C30648:0x401000\n      - 5f66b82558ca92e54e77f216ef4c066c:0x44580A\n  features:\n    - or:\n      - api: RtlGetVersion\n      - api: ntoskrnl.PsGetVersion\n      - api: GetVersion\n      - api: GetVersionEx\n      - api: VerifyVersionInfo\n      - api: VerSetConditionMask\n      - api: RtlGetNtVersionNumbers\n      - api: GetProductInfo\n      - and:\n        - match: PEB access\n        - or:\n          - and:\n            - arch: i386\n            - or:\n              - offset: 0xA4 = PEB-\u003eOSMajorVersion\n              - offset: 0xA8 = PEB-\u003eOSMinorVersion\n              - offset: 0xAC = PEB-\u003eOSBuildNumber\n          - and:\n            - arch: amd64\n            - or:\n              - offset: 0x118 = PEB-\u003eOSMajorVersion\n              - offset: 0x11C = PEB-\u003eOSMinorVersion\n              - offset: 0x120 = PEB-\u003eOSBuildNumber\n"
                                           },
                                           {
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "resolve function by parsing PE exports",
                                               "description":  "load-code/pe",
                                               "authors":  [
                                                               "sara-rn"
                                                           ],
                                               "rule_src":  "rule:\n  meta:\n    name: resolve function by parsing PE exports\n    namespace: load-code/pe\n    authors:\n      - sara-rn\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic, offset, mnemonic features\n    examples:\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x406BA1\n  features:\n    - and:\n      - os: windows\n      - or:\n        - characteristic: loop\n        - mnemonic: movzx\n      - and:\n        - offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew\n        - or:\n          - and:\n            - arch: i386\n            - offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]\n          - and:\n            - arch: amd64\n            - offset: 0x88 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT]\n        - 3 or more:\n          - offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions\n          - offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals\n          - offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames\n          - offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames\n          - offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions\n      - optional:\n        - or:\n          - api: LoadLibrary\n          - api: strcmp\n"
                                           }
                                       ],
                 "verdicts":  [
                                  "MALWARE",
                                  "TROJAN"
                              ],
                 "registry_keys_opened":  [
                                              "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\CTF\\KnownClasses",
                                              "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\CTF\\",
                                              "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\CTF\\Compatibility\\rundll32.exe",
                                              "HKEY_LOCAL_MACHINE\\Software\\Microsoft\\CTF\\TIP\\{0000897b-83df-4b96-be07-0fb58b01c4a4}\\LanguageProfile\\0x00000000\\{0001bea3-ed56-483d-a2e2-aeae25577436}"
                                          ],
                 "files_opened":  [
                                      "C:\\Windows\\SysWOW64\\rundll32.exe",
                                      "C:\\Windows\\Globalization\\Sorting\\sortdefault.nls",
                                      "C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll"
                                  ],
                 "modules_loaded":  [
                                        "kernel32.dll",
                                        "kernel32",
                                        "api-ms-win-core-localization-l1-2-1",
                                        "api-ms-win-core-fibers-l1-1-1",
                                        "GDI32.dll",
                                        "api-ms-win-core-sysinfo-l1-2-1",
                                        "USER32.dll",
                                        "C:\\Windows\\system32\\ole32.dll",
                                        "api-ms-win-core-synch-l1-2-0",
                                        "C:\\Users\\Virtual\\AppData\\Local\\Temp\\f766d2ea0d8124120d712caad5f00ac51114076fa3354fb760ae64aae39147f1.dll"
                                    ],
                 "mitre_attack_techniques":  [
                                                 {
                                                     "id":  "T1497",
                                                     "signature_description":  "Virtualization / Sandbox Evasion"
                                                 },
                                                 {
                                                     "id":  "T1045",
                                                     "signature_description":  "Software Packing"
                                                 }
                                             ],
                 "ip_traffic":  [
                                    {
                                        "destination_ip":  "239.255.255.250",
                                        "destination_port":  1900,
                                        "transport_layer_protocol":  "UDP"
                                    }
                                ],
                 "attack_techniques":  {
                                           "T1497":  [
                                                         {
                                                             "severity":  "UNKNOWN",
                                                             "description":  "Virtualization / Sandbox Evasion"
                                                         }
                                                     ],
                                           "T1045":  [
                                                         {
                                                             "severity":  "UNKNOWN",
                                                             "description":  "Software Packing"
                                                         }
                                                     ]
                                       }
             }
}
