{
    "data":  {
                 "mbc":  [
                             {
                                 "id":  "C0052",
                                 "objective":  "File System",
                                 "behavior":  "Writes File",
                                 "refs":  [
                                              {
                                                  "ref":  "#signature_matches",
                                                  "value":  "1"
                                              }
                                          ]
                             },
                             {
                                 "id":  "C0027.009",
                                 "objective":  "Cryptography",
                                 "behavior":  "Encrypt Data",
                                 "method":  "RC4",
                                 "refs":  [
                                              {
                                                  "ref":  "#signature_matches",
                                                  "value":  "4"
                                              }
                                          ]
                             },
                             {
                                 "id":  "C0021.004",
                                 "objective":  "Cryptography",
                                 "behavior":  "Generate Pseudo-random Sequence",
                                 "method":  "RC4 PRGA",
                                 "refs":  [
                                              {
                                                  "ref":  "#signature_matches",
                                                  "value":  "4"
                                              }
                                          ]
                             }
                         ],
                 "mitre_attack_techniques":  [
                                                 {
                                                     "id":  "T1027",
                                                     "severity":  "IMPACT_SEVERITY_INFO",
                                                     "signature_description":  "encrypt data using RC4 PRGA",
                                                     "refs":  [
                                                                  {
                                                                      "ref":  "#signature_matches",
                                                                      "value":  "4"
                                                                  }
                                                              ]
                                                 }
                                             ],
                 "signature_matches":  [
                                           {
                                               "id":  "1",
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "write file on Linux",
                                               "description":  "host-interaction/file-system/write",
                                               "authors":  [
                                                               "joakim@intezer.com",
                                                               "mehunhoff@google.com"
                                                           ],
                                               "match_data":  [
                                                                  "api: fwrite",
                                                                  "api: fputc",
                                                                  "api: fputs"
                                                              ],
                                               "rule_src":  "rule:\n  meta:\n    name: write file on Linux\n    namespace: host-interaction/file-system/write\n    authors:\n      - joakim@intezer.com\n      - mehunhoff@google.com\n    scopes:\n      static: instruction\n      dynamic: call\n    mbc:\n      - File System::Writes File [C0052]\n    examples:\n      - 7351f8a40c5450557b24622417fc478d:0x401E14\n  features:\n    - and:\n      - or:\n        - os: linux\n        - os: android\n      - or:\n        - api: fputc\n        - api: fputs\n        - api: putc\n        - api: write\n        - api: fputwc\n        - api: putwc\n        - api: fputws\n        - api: fwrite\n        - api: putwchar\n        - api: dprintf\n        - api: vdprintf\n        - api: fprintf\n        - api: vfprintf\n"
                                           },
                                           {
                                               "id":  "3",
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "set current directory",
                                               "description":  "host-interaction/file-system",
                                               "authors":  [
                                                               "michael.hunhoff@mandiant.com"
                                                           ],
                                               "match_data":  [
                                                                  "api: fchdir"
                                                              ],
                                               "rule_src":  "rule:\n  meta:\n    name: set current directory\n    namespace: host-interaction/file-system\n    authors:\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: function\n      dynamic: call\n  features:\n    - or:\n      - api: System.IO.Directory::SetCurrentDirectory\n      - api: kernel32.SetCurrentDirectory\n      - api: chdir\n      - api: fchdir\n"
                                           },
                                           {
                                               "id":  "4",
                                               "format":  "SIG_FORMAT_CAPA",
                                               "name":  "encrypt data using RC4 PRGA",
                                               "description":  "data-manipulation/encryption/rc4",
                                               "authors":  [
                                                               "moritz.raabe@mandiant.com"
                                                           ],
                                               "match_data":  [
                                                                  "tight loop",
                                                                  "contain loop",
                                                                  "loop"
                                                              ],
                                               "rule_src":  "rule:\n  meta:\n    name: encrypt data using RC4 PRGA\n    namespace: data-manipulation/encryption/rc4\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic, mnemonic, basicblock features\n    att\u0026ck:\n      - Defense Evasion::Obfuscated Files or Information [T1027]\n    mbc:\n      - Cryptography::Encrypt Data::RC4 [C0027.009]\n      - Cryptography::Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]\n    examples:\n      - 34404A3FB9804977C6AB86CB991FB130:0x403DB0\n      - 34404A3FB9804977C6AB86CB991FB130:0x403E50\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049F0\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x4064C6\n  features:\n    - and:\n      # TODO: maybe add characteristic for nzxor reg size\n      - count(characteristic(nzxor)): 1\n      - or:\n        - match: calculate modulo 256 via x86 assembly\n        # compiler may do this via zero-extended mov from 8-bit register\n        - count(mnemonic(movzx)): 4 or more\n      # should not call (many) functions\n      - count(characteristic(calls from)): (0, 4)\n      # should not be too simple or too complex (50 is picked by intuition)\n      - count(basic blocks): (4, 50)\n      - match: contain loop\n      - optional:\n        - or:\n          - number: 0xFF\n          - number: 0x100\n"
                                           }
                                       ],
                 "attack_techniques":  {
                                           "T1027":  [
                                                         {
                                                             "severity":  "INFO",
                                                             "description":  "encrypt data using RC4 PRGA",
                                                             "refs":  [
                                                                          {
                                                                              "ref":  "#signature_matches",
                                                                              "value":  "4"
                                                                          }
                                                                      ]
                                                         }
                                                     ]
                                       }
             }
}
